- name: ensure mpd is installed
  yum: pkg={{ item }}
  with_items:
    - mpd
    - mpc

- name: ensure mpd is enabled and started
  service: name=mpd enabled=yes state=started

- name: ensure mpd music directory is linked
  file: src=/var/lib/media/music
        dest=/var/lib/mpd/music
        state=link
        force=yes
        seuser=system_u serole=object_r setype=mpd_var_lib_t

- name: ensure music directory has correct selinux context
  file: dest=/var/lib/media/music
        state=directory
        recurse=yes
        seuser=system_u serole=object_r setype=mpd_var_lib_t

- name: ensure mpd is configured
  template: src=mpd.conf.j2
            dest=/etc/mpd.conf
            owner=root group=root mode=0644
  notify:
    - restart mpd

- name: ensure mpd port is open in firewall
  firewalld: port=6600/tcp permanent=true state=enabled

- include: backup.yml
