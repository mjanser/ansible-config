- name: ensure rpmfusion-free repository is installed
  yum: pkg=http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_distribution_version }}.noarch.rpm state=present

- name: ensure rpmfusion-nonfree repository is installed
  yum: pkg=http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ ansible_distribution_version }}.noarch.rpm state=present

- name: ensure livna repository is not installed
  yum: pkg=livna-release state=absent

- name: ensure remi repository is installed
  yum: pkg="http://rpms.famillecollet.com/fedora/remi-release-{{ ansible_distribution_version }}.rpm" state=present

- command: cat /etc/yum.repos.d/remi.repo
  register: remi_repo
  changed_when: false

- name: ensure remi repository is enabled
  command: yum-config-manager --enable remi
  when: "'enabled=0' in remi_repo.stdout"

- name: ensure remi repository is limited to a few packages
  command: yum-config-manager --save --setopt="remi.includepkgs=remi-release libdvdcss"
  when: "'includepkgs =' not in remi_repo.stdout"

- name: ensure docker is installed
  yum: pkg=docker-io

- name: ensure docker service runs
  service: name=docker enabled=yes state=started

- name: ensure wheel users have access to libvirt
  copy: src=libvirt.rules
        dest=/etc/polkit-1/rules.d/80-libvirt.rules
        owner=root group=root mode=0644

- name: ensure wheel don't need password for sudo
  lineinfile: dest=/etc/sudoers
              regexp='^%wheel'
              line='%wheel ALL=(ALL) NOPASSWD:ALL'
              validate='visudo -cf %s'

- name: ensure X forwarding is enabled in ssh
  lineinfile: dest=/etc/ssh/sshd_config
              regexp='^X11Forwarding '
              line='X11Forwarding yes'

- include: base.yml tags=fedora-base

- include: certificate.yml

- include: ssmtp.yml tags=ssmtp

- include: logwatch.yml tags=logwatch

- include: tuned.yml tags=tuned

- include: ssd.yml tags=ssd
  when: ansible_devices.sda.rotational == '0'

- include: accounts.yml tags=accounts
