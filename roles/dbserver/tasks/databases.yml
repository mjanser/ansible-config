- name: ensure mariadb databases exist
  mysql_db: name="{{ item.name }}"
            encoding="{{ item.encoding }}"
            collation="{{ item.collation }}"
  register: databases_created
  with_items: mariadb.databases

- name: import mariadb databases from backup
  mysql_db: name="{{ item.item.name }}"
            state=import
            target="/var/lib/backup/{{ ansible_hostname }}/db/{{ item.item.name }}_latest.sql"
  when: item.changed and item.item.import
  with_items: databases_created.results
